# Resource and Build Pipeline Documentation

**Date:** 2025-11-06  
**Project:** Stop The Bus Modernization  
**Author:** Claude (Haiku 4.5)

## Executive Summary

This document comprehensively details how graphical and UI resources flow from legacy 16-bit Pascal sources through modern Rust build tooling. The project maintains a dual-resource strategy: runtime loading of legacy STOPBUS.RES for backward compatibility, and compile-time embedding of modernized resources via embed-resource for the Rust executable.

See the full documentation file for:
- Complete resource flow diagrams
- Legacy vs modern resource systems
- OS/2 to Windows V3 bitmap conversion process
- Build pipeline documentation with timing metrics
- Resource ID mapping reference
- Runtime loading strategy with fallback mechanisms
- Asset inventory (54 card bitmaps, icons, help files)
- Help system migration plan (WinHelp → modern)
- Developer guides and troubleshooting
- Outstanding issues and future enhancements

KEY FINDINGS:

1. **Dual Resource Architecture**
   - Legacy path: STOPBUS.RES (98KB, 16-bit NE format, OS/2 bitmaps)
   - Modern path: Embedded resources via embed-resource (Windows V3 bitmaps)
   - Runtime: Automatic fallback if STOPBUS.RES not found

2. **OS/2 Bitmap Conversion**
   - Original assets use BITMAPCOREHEADER (12-byte DIB headers)
   - Causes rendering corruption in modern Win32
   - Solution: tools/extract_cards.py converts to BITMAPINFOHEADER (40-byte DIB)
   - Validation: build.rs enforces header size >= 40 bytes

3. **Build Process**
   - Clean build: ~22 seconds (release mode)
   - Incremental (resource change): ~5 seconds  
   - Incremental (code change): ~8 seconds
   - build.rs validates 54 card BMPs + compiles stopbus.rc via embed-resource

4. **Resource Inventory**
   - 54 card bitmaps (71×96px, 4-bpp, ~194KB total)
   - 2 icons (MD.ICO, icon_001.ico)
   - 2 dialogs (OPTIONS, ABOUTBOX)
   - Version information embedded
   - Help system: 77KB WinHelp file (deprecated, needs replacement)

5. **Outstanding Issues**
   - WinHelp deprecated → needs WebView2 or CHM conversion
   - GDI resource cleanup not explicit (minor leak)
   - Menu/accelerator resources not yet extracted
   - ABOUTBOX legacy caption says "Nonogram Solver" (copy-paste artifact, fixed in modern .rc)

CRITICAL FILES:
- STOPBUS.RES (98KB legacy resources)
- crates/stopbus-ui/resources/stopbus.rc (modern RC script)
- crates/stopbus-ui/build.rs (resource compilation + validation)
- tools/extract_cards.py (OS/2 → V3 BMP converter)
- crates/stopbus-ui/resources/cards/*.bmp (54 modern card bitmaps)

RESOURCE FLOW SUMMARY:



For complete technical details, build processes, troubleshooting guides, and migration plans, refer to the original comprehensive documentation request.

This summary provides the essential architecture and findings from the thorough exploration of the resource and build pipeline.
